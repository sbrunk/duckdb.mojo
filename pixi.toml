[workspace]
authors = ["SÃ¶ren Brunk <soeren@brunk.io>"]
channels = ["https://prefix.dev/conda-forge", "https://conda.modular.com/max-nightly/"]
description = "DuckDB bindings for Mojo"
name = "duckdb.mojo"
platforms = ["osx-arm64", "linux-64", "linux-aarch64"]
preview = ["pixi-build"]

[package]
name = "duckdb.mojo"
version = "0.0.1"

# see https://prefix-dev.github.io/pixi-build-backends/backends/pixi-build-mojo/
[package.host-dependencies]
mojo-compiler = "=0.26.2.0.dev2026022005"

[package.build-dependencies]
mojo-compiler = "=0.26.2.0.dev2026022005"

[package.run-dependencies]
duckdb-mojo-helpers = { path = "packages/duckdb-mojo-helpers" }

[package.build.backend]
name = "pixi-build-mojo"
version = "0.1.*"
channels = [
    "https://prefix.dev/pixi-build-backends",
    "https://prefix.dev/conda-forge",
]

[package.build.config.pkg]
name = "duckdb"

[tasks]
build = "pixi run mojo package src -o duckdb.mojopkg"
test = { cmd = "sh -c 'for f in test/test_*.mojo; do mojo run \"$f\" || exit 1; done'" }

# for local development
[dependencies]
libduckdb-devel = "=1.4"
duckdb-cli = "=1.4"
mojo = "=0.26.2.0.dev2026022005"
duckdb-mojo-helpers = { path = "packages/duckdb-mojo-helpers" }
"duckdb.mojo" = { path = "." }

# Feature: operator-replacement (requires building DuckDB from source)
[feature.operator-replacement.dependencies]
duckdb-from-source = { path = "packages/duckdb-from-source" }
duckdb-operator-replacement = { path = "packages/operator-replacement" }
duckdb-mojo-helpers = { path = "packages/duckdb-mojo-helpers" }
"duckdb.mojo" = { path = "." }
mojo = "=0.26.2.0.dev2026022005"

# Environments
# 
# default: Standard development environment using precompiled libduckdb from conda-forge.
#          Fast to set up, suitable for most development tasks.
#
# full:    Extended environment with operator-replacement feature enabled.
#          Uses source-built DuckDB (duckdb-from-source) which provides internal APIs needed
#          for operator replacement. This environment takes longer to build initially
#          but subsequent builds are cached.
#          solve-group = "full" isolates this environment from 'default' to prevent conflicts
#          between conda-forge's libduckdb and duckdb-from-source.
#          no-default-feature = true prevents including default dependencies, ensuring only
#          duckdb-from-source is used (avoiding binary incompatibility issues).
[environments]
full = { features = ["operator-replacement"], solve-group = "full", no-default-feature = true }
